# GoTF proto options

[gotf.proto] extends `google.protobuf.MessageOptions` and `google.protobuf.FieldOptions`
to allow mapping protobuf messages and fields to a terraform resources/ datasources and attributes.

- [`gotf.provider`](#gotfprovider) a message option to generate terraform provider block.
- [`gotf.resource`](#gotfresource-and-gotfdatasource) a message option to generate terraform resource block.
- [`gotf.datasource`](#gotfresource-and-gotfdatasource) a message option to generate terraform datasources block.
- [`gotf.Attribute`](#gotfattribute) an (optional) field option for generating terraform attributes on blocks.

## `gotf.provider`

The provider option needs to be set at most once in all the proto files combined that are passed to protoc.
It is a message option to generate terraform provider block.

<details>
<summary>Example usage</summary>

```proto
message MyProvider {
  option (gotf.provider) = {
    name: "Xyz"
    description: "Desction set on the provider schema in terrafrom"
    provider_package: "github.com/travix/gotf-example/providerpb"
  };
  // ... message content
}
```

</details>

### `name:`

⚙️ _Optional_. The default value is message's name.

This value should be `UpperCamelCase` as it is used to create struct and method names in the generated go code.
The snakecase conversion of this value is the prefix for your datasources and resources, such as `xyz_my_resource` or  `xyz_my_datasource`.

### `description:`

⚙️ _Optional_. The default value is comment on the message.

### `provider_package:`

⚙️ _Optional_. The default value is the `providerpb` option in the proto file.

This is the package where all generated terraform go code will be placed.
If the [module option] is set, then this value will respective to the module.
`.;pkg` is not supported as value before the semicolon needs to be a name/ import path

### Message content

All the fields in the message are used as configuration attributes on a terraform block.
See [gotf.Attribute](#gotfattribute) documentation for how individual fields are mapped to a terraform attributes.

---

## `gotf.resource` and `gotf.datasource`

Block options contain the same (option) fields. The same message can have both options set.

<details>
<summary>Example usage</summary>

```proto
message MyResource {
  option (gotf.resource) = {
    name: "CustomName"
    explicit_fields: true
    client: "MyResourceServiceClient"
    client: "OtherResourceServiceClient"
    description: "Desction set on the resource schema in terrafrom"
  };
  // ... message content
}

// Other comment that will be used as description on the datasource block
message Other {
  option (gotf.datasource) = {};
  // ... message content
}
```

</details>

### `name:`

⚙️ _Optional_. The default value is message's name.

This value should be `UpperCamelCase` as it is used to create struct and method names in the generated go code.
The snakecase conversion of this value is the suffix for your datasources and resources, such as `xyz_custom_name` or  `xyz_other`.

### `explicit_fields:`

⚙️ _Optional_. The default value is `false`.

If set to `true` only fields with [`gotf.Attribute`](#gotfattribute-option) in the message will be generated as an attributes on the block.

### `client:`

⚙️ _Optional_ repeating.

List of Clients (names) used by this block. If the block requires multiple clients, it can be specified multiple times.

If this field is set then generated code will call [exec] with `.Set<ClientName>(client)`.
Refer [exec] for more details about usage of a client field.

**Clients should be generated by grpc in the same go_package as the message.**

### `description:`

⚙️ _Optional_.

The default value is comments on the proto message.

### Message content

All the fields in the message are used as configuration attributes on a terraform block.
See [gotf.Attribute option](#gotfattribute-option) documentation for how individual fields are mapped to a terraform attributes.

---

## `gotf.Attribute`

`gotf.Attribute` option can be used on a field to customize/ generate terraform attributes on a block.

<details>
<summary>Example usage</summary>

```proto
message MyProvider {
  option (gotf.provider) = {};
  string endpoint = 1; // will be generated as `endpoint` attribute
  string secret_key = 1 [(gotf.attribute) = { sensitive: true }];  // will be generated as `secret_key` attribute with `sensitive` set to true
}

message MyResource {
  option (gotf.resource) = {};
  string name = 1;
  string email = 2 [(gotf.attribute) = { skip: true }]; // this field will not be generated as an attribute
}

message OtherDatasource {
  option (gotf.datasource) = { explicit_fields: true };
  string name = 1; // this field will not be generated as an attribute
  string email = 2 [(gotf.attribute) = { must_be: Required, md_description: "md-desc", deprecation: "depre-note" }]; // will required attribute on the block
  string displayName = 3 [(gotf.attribute) = { must_be: Optional, sensitive: true, description: "desc",  }]; // will required attribute on the block
}
```

</details>

### `skip:`

⚙️ _Optional_. The default value is `false`.

If set to `true` the field will not be generated as an attribute on the block.

### `must_be:`

⚙️ _Optional_. The default value is `Optional`.

The value of this field is used to determine if the field is required, optional or computed on the block.
Available values:
- `Computed` field will be computed by provider, user can't set it in a terraform script (default).
- `Optional` field is optional, user can set it in a terraform script.
- `OptionalAndComputed` field is optional, but will be computed or overriden by provider.
- `Required` field is required, user must set it in a terraform script.

### `name:`

⚙️ _Optional_.
The default value is field name.

This value is converted to snakecase before being used as an attribute name on the block.
Refer [attribute-names] best practices for more details.

### `sensitive:`

⚙️ _Optional_. The default value is `false`.

If is set to `true` field will be marked as sensitive.

### `description:`

⚙️ _Optional_.

The default value is comments on the proto field.

### `md_description:`

⚙️ _Optional_.

The default value is comments on the proto field.

### `deprecation:`

⚙️ _Optional_. The default value is `""`.

If set to a non-empty string, the field will be marked as deprecated with the value as a deprecation note.

[gotf-example]: https://github.com/travix/gotf-example
[gotf]: https://github.com/travix/gotf
[gotf.proto]: ../gotf.proto
[buf.build/travix/gotf]: https://buf.build/travix/gotf
[attribute-names]: https://developer.hashicorp.com/terraform/plugin/best-practices/naming#attribute-names
[exec]: ./executor.md
[module option]: ./cli-options.md#module
